<template>
  <div class="bg-white header position-relative">
    <div style=cursor:pointer class="position-absolute d-md-none d-block h-100" @click="setMenuOpen(!menu_open_state)">
      <div class="h-100 d-flex justify-content-center align-items-center">
        <svg viewBox="0 0 1024 1024" width="23" height="23">
          <path fill="#8a8a8a" d="M936.19430083 229.20379943L87.80569917 229.20379943c-26.01725045 0-47.1327001-21.11544964-47.1327001-47.13270007s21.11544964-47.1327001 47.1327001-47.13270011l848.38860166 0c26.06438315 0 47.1327001 21.11544964 47.1327001 47.13270011S962.25868398 229.20379943 936.19430083 229.20379943z"/>
          <path fill="#8a8a8a" d="M936.19430083 559.1327001L87.80569917 559.1327001c-26.01725045 0-47.1327001-21.11544964-47.1327001-47.1327001s21.11544964-47.1327001 47.1327001-47.1327001l848.38860166 0c26.06438315 0 47.1327001 21.11544964 47.1327001 47.1327001S962.25868398 559.1327001 936.19430083 559.1327001z" />
          <path fill="#8a8a8a" d="M936.19430083 889.06160075L87.80569917 889.06160075c-26.01725045 0-47.1327001-21.11544964-47.1327001-47.13270011s21.11544964-47.1327001 47.1327001-47.13270007l848.38860166 0c26.06438315 0 47.1327001 21.11544964 47.1327001 47.13270007S962.25868398 889.06160075 936.19430083 889.06160075z"/>
        </svg>
      </div>
      <div v-if="loginState" class="user-image user-image-md">
        <img src="/static/image/default.jpg" alt="">
      </div>
    </div>
    <div class="pl-4 container-fluid d-flex justify-content-md-between justify-content-center h-100">
      <div class="ml-md-4 d-flex justify-content-center align-items-center logo">
        <img src="/static/image/logo.png" alt="" height="35px">
        <span class="d-none d-md-inline ml-2" >OnlineJudge</span>
      </div>
      <div class="d-none d-md-flex justify-content-between align-content-center">
        <div class="form-group m-auto d-flex header-search-group h-50">
          <svg viewBox="0 0 1024 1024" class="m-auto" width="23" height="23">
            <path fill="#dadce0" d="M238.762667 238.805333a277.333333 277.333333 0 0 1 432.170666 341.632l141.056 141.056a64 64 0 1 1-90.538666 90.496l-141.013334-141.056A277.333333 277.333333 0 0 1 238.762667 238.805333zM299.136 299.093333a192 192 0 1 0 271.530667 0 192 192 0 0 0-271.530667 0z" />
          </svg>
          <input type="text" class="form-control-sm m-auto form-control border-0 shadow-none">
        </div>
        <div v-if="loginState" class="user-image-box mx-4 h-100 d-flex justify-content-center align-items-center position-relative" style="width: 45px;">
          <div class="user-image" :class="{'active': user_image_show}" @click="user_image_show = !user_image_show">
            <img src="/static/image/default.jpg" alt="">
          </div>
          <div class="user-control d-none position-absolute">
            <span>{{user.username}}</span>
            <hr>
            <ul>
              <li @click="user_image_show = false"><router-link :to="{name: 'userInfo', params: {'user_id': user.id}}">
                <svg class="mr-2" viewBox="0 0 1024 1024" width="23" height="23">
                  <path fill="currentColor" d="M943.9 220l0.1 0.1v583.7l-0.1 0.1H80.2l-0.1-0.1V220.1l0.1-0.1h863.7m0.1-80H80c-44 0-80 36-80 80v584c0 44 36 80 80 80h864c44 0 80-36 80-80V220c0-44-36-80-80-80z" />
                  <path fill="currentColor" d="M341.4 380c18.4 0 33.3 14.2 33.3 31.7s-14.9 31.7-33.3 31.7-33.3-14.2-33.3-31.7 15-31.7 33.3-31.7M388 614.1c22.8 0 42.7 11.7 53.8 29.2-16 0.7-34.4 0.7-53.8 0.7h-85c-19.4 0-38 0-53.8-0.6 11.1-17.5 31.1-29.3 53.8-29.3h85M341.4 300c-62.5 0-113.3 50.1-113.3 111.7s50.8 111.7 113.3 111.7 113.3-50.1 113.3-111.7C454.8 350.1 404 300 341.4 300zM388 534.1h-85c-78.9 0-143.1 63.2-143.1 140.9v8.4c0 40.5 63.2 40.5 143.1 40.5h85c76.8 0 143.1 0 143.1-40.5V675c0-77.7-64.2-140.9-143.1-140.9zM824 380H604c-22 0-40-18-40-40s18-40 40-40h220c22 0 40 18 40 40s-18 40-40 40zM824 540H659c-22 0-40-18-40-40s18-40 40-40h165c22 0 40 18 40 40s-18 40-40 40zM824 700H659c-22 0-40-18-40-40s18-40 40-40h165c22 0 40 18 40 40s-18 40-40 40z" />
                </svg>
                个人中心
              </router-link></li>
              <!--              <li><a href="#">-->
              <!--                <svg class="mr-2" viewBox="0 0 1243 1024" width="23" height="23">-->
              <!--                  <path fill="currentColor" d="M916.706448 392.49304c65.91617 0 119.500587 53.607078 119.500587 119.500587s-53.584417 119.500587-119.500587 119.500587h-20.721933a360.538405 360.538405 0 0 1-14.362731 34.894879l14.578009 14.602087c22.490896 22.513557 34.89488 52.509443 34.89488 84.510815 0 31.977295-12.403984 61.995842-34.89488 84.486738-22.489479 22.513557-52.508027 34.89488-84.485322 34.89488-31.978711 0-61.997259-12.381323-84.512231-34.89488l-14.57801-14.602086a360.265059 360.265059 0 0 1-34.918956 14.386808v20.721933c0 65.893509-53.583001 119.500587-119.500587 119.500587s-119.500587-53.607078-119.500588-119.500587v-20.721933a358.134939 358.134939 0 0 1-34.918956-14.386808l-14.602087 14.602086c-22.490896 22.513557-52.508027 34.89488-84.488154 34.89488-31.978711 0-61.995842-12.381323-84.485322-34.89488-22.490896-22.489479-34.89488-52.508027-34.89488-84.485322 0-32.002788 12.403984-61.997259 34.89488-84.512231l14.602087-14.578009a357.928159 357.928159 0 0 1-14.386809-34.918957h-20.721933c-65.91617 0-119.500587-53.607078-119.500587-119.500587s53.584417-119.500587 119.500587-119.500587h20.721933a357.98906 357.98906 0 0 1 14.386809-34.918957l-14.602087-14.57801c-22.490896-22.513557-34.89488-52.509443-34.89488-84.512231 0-31.977295 12.403984-61.995842 34.89488-84.485322 22.489479-22.513557 52.508027-34.89488 84.485322-34.89488 31.978711 0 61.997259 12.381323 84.488154 34.89488l14.602087 14.578009a363.565046 363.565046 0 0 1 34.918956-14.362731V153.491865c0-65.893509 53.583001-119.500587 119.500588-119.500587s119.500587 53.607078 119.500587 119.500587v20.721933a360.621967 360.621967 0 0 1 34.918956 14.386809l14.57801-14.602087c22.513557-22.513557 52.532104-34.89488 84.512231-34.89488 31.978711 0 61.995842 12.381323 84.485322 34.89488 22.490896 22.489479 34.89488 52.508027 34.89488 84.485322 0 32.002788-12.403984 61.997259-34.89488 84.510815l-14.578009 14.603503a359.677293 359.677293 0 0 1 14.362731 34.89488h20.721933z m-62.762062-91.752374c11.232701-11.232701 17.399285-26.218606 17.399285-42.255408s-6.166584-31.022706-17.399285-42.23133c-22.465402-22.442741-62.021336-22.442741-84.486739 0l-46.008611 46.008611-19.71919-11.0415c-19.908975-11.115148-41.44245-20.005283-64.050898-26.433884l-21.726092-6.143924V153.490449c0-32.958793-26.816286-59.749585-59.751002-59.749585-32.9333 0-59.749585 26.792209-59.749585 59.749585v65.152782l-21.726092 6.143924c-22.656603 6.452678-44.214155 15.318736-64.052315 26.433884l-19.717774 11.0415-46.008611-46.008611c-22.465402-22.442741-62.021336-22.442741-84.486738 0-11.232701 11.208624-17.397869 26.194529-17.397869 42.23133s6.165168 31.022706 17.397869 42.255408l46.008611 46.008611-11.065577 19.741851c-11.089654 19.812666-19.958545 41.346141-26.409807 64.028238l-6.142507 21.726092h-65.152783c-32.934716 0-59.749585 26.792209-59.749585 59.751001 0 32.957377 26.81487 59.749585 59.749585 59.749586H264.851459l6.142507 21.726092c6.452678 22.679264 15.320152 44.214155 26.409807 64.052314l11.064161 19.717774L262.460739 723.250836c-11.234117 11.208624-17.399285 26.218606-17.399286 42.255408 0 16.012725 6.165168 31.022706 17.399286 42.23133 22.465402 22.442741 62.021336 22.442741 84.486738 0l46.008611-46.007194 19.717774 11.0415c19.83816 11.113732 41.395712 19.97979 64.052315 26.433884l21.726092 6.142507v65.152782c0 32.958793 26.816286 59.749585 59.749585 59.749586 32.934716 0 59.751002-26.792209 59.751002-59.749586v-65.152782l21.726092-6.142507c22.609865-6.430017 44.14334-15.320152 64.050898-26.433884l19.71919-11.0415 46.008611 46.007194c22.465402 22.442741 62.01992 22.442741 84.486739 0 11.232701-11.208624 17.399285-26.218606 17.399285-42.23133 0-16.035385-6.166584-31.045367-17.399285-42.255408l-45.960457-46.008611 10.993345-19.717774c11.137809-19.957129 20.029361-41.49202 26.433884-64.052314l6.143924-21.726092h65.152782c32.9333 0 59.749585-26.792209 59.749586-59.749586 0-32.958793-26.816286-59.751002-59.749586-59.751001h-65.152782l-6.143924-21.726092c-6.404523-22.560295-15.296075-44.095186-26.433884-64.050899l-10.993345-19.71919 45.960457-46.008611zM558.204687 691.243799c-98.850886 0-179.250173-80.399287-179.250173-179.250172S459.353801 332.743454 558.204687 332.743454s179.250173 80.399287 179.250172 179.250173S657.055572 691.243799 558.204687 691.243799z m0-298.750759c-65.917586 0-119.500587 53.607078-119.500588 119.500587s53.583001 119.500587 119.500588 119.500587 119.500587-53.607078 119.500587-119.500587-53.583001-119.500587-119.500587-119.500587z" />-->
              <!--                  <path fill="currentColor" d="M942.199907 383.99522c70.604134 0 127.998407 57.419767 127.998406 127.998407s-57.394273 127.998407-127.998406 127.998406h-22.194889a386.092765 386.092765 0 0 1-15.383886 37.376243l15.614744 15.640237c24.089902 24.113979 37.376243 56.242819 37.376243 90.52019 0 34.251878-13.286341 66.404794-37.376243 90.494696-24.088486 24.113979-56.241402 37.376243-90.49328 37.376243-34.253294 0-66.406211-13.262264-90.521607-37.376243l-15.614743-15.640236a385.85341 385.85341 0 0 1-37.401736 15.409379v22.194888c0 70.57864-57.392857 127.998407-127.998407 127.998407s-127.998407-57.419767-127.998407-127.998407v-22.194888a383.577411 383.577411 0 0 1-37.401736-15.409379l-15.640237 15.640236c-24.089902 24.113979-56.241402 37.376243-90.496113 37.376243-34.253294 0-66.404794-13.262264-90.49328-37.376243-24.089902-24.088486-37.376243-56.241402-37.376243-90.49328 0-34.278788 13.286341-66.406211 37.376243-90.521606l15.640237-15.614743a383.369214 383.369214 0 0 1-15.409379-37.401737h-22.194889c-70.604134 0-127.998407-57.419767-127.998406-127.998406s57.394273-127.998407 127.998406-127.998407h22.194889a383.287068 383.287068 0 0 1 15.409379-37.401736l-15.640237-15.614744c-24.089902-24.113979-37.376243-56.244235-37.376243-90.521606 0-34.251878 13.286341-66.404794 37.376243-90.49328 24.088486-24.113979 56.241402-37.376243 90.49328-37.376243 34.253294 0 66.406211 13.262264 90.496113 37.376243l15.640237 15.614743a389.355928 389.355928 0 0 1 37.401736-15.383886V127.998407c0-70.57864 57.392857-127.998407 127.998407-127.998407s127.998407 57.419767 127.998407 127.998407v22.194888a386.210318 386.210318 0 0 1 37.401736 15.409379l15.614743-15.640236c24.113979-24.113979 56.268312-37.376243 90.521607-37.376243 34.253294 0 66.404794 13.262264 90.49328 37.376243 24.089902 24.088486 37.376243 56.241402 37.376243 90.49328 0 34.278788-13.286341 66.406211-37.376243 90.52019l-15.614744 15.641653c5.734612 12.110809 10.905535 24.601188 15.383886 37.376243h22.194889v0.001416z m-67.224834-98.277283c12.031496-12.031496 18.637135-28.082461 18.637134-45.260803s-6.605638-33.229307-18.637134-45.233893c-24.062992-24.038915-66.431704-24.038915-90.494697 0l-49.280272 49.280271-21.12133-11.826132c-21.325278-11.905445-44.389777-21.427252-68.60573-28.313318l-23.271279-6.581561V127.99699c0-35.302775-28.72263-63.998495-63.999911-63.998495-35.275865 0-63.998495 28.697137-63.998495 63.998495v69.785511l-23.271279 6.581561c-24.268356 6.91156-47.358348 16.407873-68.607146 28.313318l-21.119914 11.826132L331.924748 195.223241c-24.062992-24.038915-66.431704-24.038915-90.494696 0-12.031496 12.006003-18.635718 28.056967-18.635719 45.233893s6.604222 33.229307 18.635719 45.260803l49.280271 49.280272-11.853042 21.145407C266.980162 377.365504 257.4796 400.430003 250.569457 424.725269l-6.578729 23.271279h-69.78551c-35.277281 0-63.998495 28.697137-63.998495 63.999911 0 35.301359 28.721214 63.998495 63.998495 63.998495h69.78551L250.569457 599.266233c6.91156 24.292433 16.40929 47.358348 28.287824 68.607146l11.851626 21.119914-49.278855 49.280272c-12.032912 12.006003-18.637135 28.082461-18.637135 45.260803 0 17.151432 6.604222 33.229307 18.637135 45.233894 24.062992 24.038915 66.431704 24.038915 90.494696 0l49.280272-49.278856 21.119914 11.826132c21.248798 11.904029 44.33879 21.400342 68.607146 28.313319l23.271279 6.578728v69.785511c0 35.302775 28.72263 63.998495 63.998495 63.998495 35.277281 0 63.999911-28.697137 63.999911-63.998495v-69.785511l23.271279-6.578728c24.217369-6.887483 47.281868-16.40929 68.60573-28.313319l21.12133-11.826132 49.280272 49.278856c24.062992 24.038915 66.430288 24.038915 90.494697 0 12.031496-12.006003 18.637135-28.082461 18.637134-45.233894 0-17.17551-6.605638-33.253384-18.637134-45.260803l-49.229285-49.280272 11.775145-21.119914c11.929522-21.376265 21.454162-44.44218 28.313318-68.607146l6.580145-23.271279h69.785511c35.274449 0 63.998495-28.697137 63.998495-63.998495 0-35.302775-28.72263-63.999911-63.998495-63.999911h-69.785511l-6.580145-23.271279c-6.860573-24.164966-16.383796-47.230881-28.313318-68.60573l-11.775145-21.12133 49.229285-49.280272zM558.204687 703.990528c-105.879999 0-191.996902-86.116903-191.996902-191.996901S452.324688 319.996725 558.204687 319.996725s191.996902 86.116903 191.996901 191.996902S664.084685 703.990528 558.204687 703.990528z m0-319.995308c-70.60555 0-127.998407 57.419767-127.998407 127.998407s57.392857 127.998407 127.998407 127.998406 127.998407-57.419767 127.998406-127.998406-57.392857-127.998407-127.998406-127.998407z" />-->
              <!--                </svg>-->
              <!--                设置-->
              <!--              </a></li>-->
              <hr>
              <li @click="user_image_show = false"><a href="" @click.prevent="logout">
                <svg class="mr-2" viewBox="0 0 1024 1024" width="22" height="22">
                  <path fill="currentColor" d="M896.8 282.5l-55.2 32.3c9.2 15.3 17.4 31.4 24.4 48 20 47.3 30.2 97.6 30.2 149.4S886 614.4 865.9 661.7c-19.3 45.7-47 86.8-82.3 122.1s-76.4 63-122.1 82.3c-47.3 20-97.6 30.1-149.4 30.1s-102.2-10.1-149.4-30.1c-4.8-2-9.6-4.2-14.3-6.4-40-18.9-76.2-44.4-107.8-75.9-25.4-25.4-47-53.9-64.2-85-6.7-12-12.7-24.4-18.1-37.1-20-47.3-30.2-97.6-30.2-149.5s10.1-102.1 30.2-149.4c19.3-45.7 47-86.8 82.3-122.1s76.4-63 122.1-82.3c47.3-20 97.6-30.1 149.4-30.1s102.2 10.1 149.4 30.1c2.9 1.2 5.8 2.5 8.7 3.8l27.1-58c-56.5-25.7-119.2-40-185.2-40-247.4 0-448 200.6-448 448 0 79.5 20.7 154.1 57 218.9 45.5 81.1 115.6 146.7 200.1 186.5 57.9 27.3 122.6 42.6 190.8 42.6 247.4 0 448-200.6 448-448 0.1-84-23-162.5-63.2-229.7z" />
                  <path fill="currentColor" d="M758.1 201.9a32 32 0 1 0 64 0 32 32 0 1 0-64 0zM670.5 353.8c-12.5-12.5-32.8-12.5-45.3 0L512.1 467 399 353.8c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l113.1 113.1-113.1 113.2c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l113.1-113.1 113.1 113.1c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L557.4 512.2l113.1-113.1c12.5-12.5 12.5-32.8 0-45.3z"/>
                </svg>
                退出
              </a></li>
            </ul>
          </div>
        </div>
        <div v-if="!loginState" class="mx-4 h-100 d-flex justify-content-center align-items-center">
          <router-link class="text-green" :to="{name: 'login'}">登陆 / 注册</router-link>
        </div>
      </div>
    </div>
  </div>
</template>

<!--顶部navbar-->
<script>
  import {header_mapGetters, header_mapMutations} from "../store/headers/header_config";
  import {login_state_mapGetters, login_state_mapMutations, login_state_mapActions} from "../store/login_state";
  export default {
    name: "headers",
    data(){
      return {
        user_image_show: false,
      }
    },
    computed: {
      ...header_mapGetters,
      ...login_state_mapGetters,
    },
    mounted() {
      this.setToken(sessionStorage.token || localStorage.token);
      this.axios({
        url: '/authenticate/',
        method: 'get',
      }).then(res=>{
          if(res.status === 200){
            this.setLoginState(res.data.is_login);
            this.setUser(res.data.user);
          }
          else if(res.status === 401){
            this.$router.replace({name: 'login'});
          }
        }
      ).catch(error=>{
          this.$router.replace({name: 'login'});
        }
      );
    },
    methods: {
      ...header_mapMutations,
      ...login_state_mapActions,
      ...login_state_mapMutations,
    },
  }
</script>

<style scoped>
  .logo{
    font-size: 1.5em;
    line-height: 40px;
    color: #273849;
    font-family: "Dosis", "Source Sans Pro", "Helvetica Neue", Arial, sans-serif;
    font-weight: 500;
  }
  .header{
    height: 60px;
  }
  .header-search-group{
    border-radius: 15px;
    border: 1px solid #dadce0;
    overflow: hidden;
    padding: 0 5px;
  }
  .header-search-group:focus{
    border: 1px solid #17bf63;
  }
  .header-search-group input{
    font-size: .8em;
    padding: 0 5px!important;
  }
  .user-image{
    position: absolute;
    height: 45px;
    width: 45px;
    overflow: hidden;
    border-radius: 50%;
    border: 1px solid #dadce0;
    box-sizing: border-box;
    transition: all .14s linear;
    display: flex;
    justify-content: center;
    align-items: center;
    left: 0;
    top: 7.5px;
    cursor: pointer;
    background: #fff;
    z-index: 2;
  }
  .user-image>img{
    border-radius: 50%;
    width:40px;
    height:40px;
    box-sizing: border-box;
    user-select:none;
  }
  .user-image.active{
    position: absolute;
    left: -20px;
    top: 25px;
    height: 60px;
    width: 60px;
  }
  .user-image.active>img{
    width:50px;
    height:50px;
  }
  .user-image.active+.user-control{
    display: block!important;
    top: 60px;
    left: -260px;
    background: white;
    width: 330px;
    border-radius: 5px;
    border: 1px solid #dadce0;
    padding: 25px 25px;
    z-index: 1;
  }
  .user-control span{
    color: black;
    font-size: 1.5rem;
    font-weight: 500;
  }
  .user-control ul{
    display: block;
    list-style-type: circle;
    margin-block-start: 0px;
    margin-block-end: 0px;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    padding-inline-start: 40px;
    color: #8a8a8a;
    cursor: pointer;
  }
  .user-control ul li a{
    display: flex;
    align-items: center;
    justify-content: flex-start;
    text-decoration: none;
    padding: 10px 15px;
    color: rgba(0, 0, 0, 0.6);
    border-radius: 0 50px 50px 0;
  }
  .user-control ul li a:hover{
    color:#17bf63;
    background-color: rgba(79, 192, 141, 0.2);
    text-shadow: 0px 0px 0px;
  }
  .user-image.user-image-md{
    left: 27px;
    top: 12.5px;
    width: 35px;
    height: 35px;
  }
  .user-image.user-image-md>img{
    height: 30px;
    width: 30px;
  }
  .text-green{
    text-decoration: none;
    color: #17bf63;
    box-sizing: border-box;
    border-top: 1.5px solid transparent;
    border-bottom: 1.5px solid transparent;
  }
  .text-green:hover{
    border-bottom: 1.5px solid #17bf63;
  }
</style>
